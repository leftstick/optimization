<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">

        <title>前端优化</title>

        <meta name="description" content="浅谈前端优化">
        <meta name="author" content="Howard.Zuo">

        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <link rel="stylesheet" href="css/reveal.css">
        <link rel="stylesheet" href="css/theme/blood.css" id="theme">

        <!-- Theme used for syntax highlighting of code -->
        <link rel="stylesheet" href="lib/css/zenburn.css">

        <link rel="icon" href="img/favicon.ico" type="image/x-icon">

        <!-- Printing and PDF exports -->
        <script>
            var link = document.createElement( 'link' );
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
            document.getElementsByTagName( 'head' )[0].appendChild( link );
        </script>

        <!--[if lt IE 9]>
        <script src="lib/js/html5shiv.js"></script>
        <![endif]-->
    </head>

    <body>

        <div class="reveal">

            <!-- Any section element inside of this container is displayed as a slide -->
            <div class="slides">
                <section>
                    <h1>浅谈前端优化</h1>
                    <p>
                        <small>Created by <a href="https://github.com/leftstick">leftstick</a> / <a href="http://weibo.com/1837649133">@右领军大都督</a></small>
                    </p>
                </section>

                <section>
                    <section>
                        <h2>你的期待？</h2>
                        <img src="img/worry.jpg" alt="">
                    </section>
                    <section>
                        <h2>不要优化</h2>
                        <img src="img/troll-face.png" alt="">
                    </section>
                </section>

                <section>
                    <section>
                        <h1>什么是前端优化</h1>
                        <h3>优化什么？</h3>
                    </section>
                    <section>
                        <h2>两手抓</h2>
                        <ul>
                            <li>工程优化</li>
                            <li>程序优化</li>
                        </ul>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>为什么要工程优化</h2>
                    </section>
                    <section>
                        <h2>前端空前繁荣</h2>
                        <p>详见：<a href="https://segmentfault.com/a/1190000007083024" target="_blank">2016年里做前端是怎样一种体验</a></p>
                        <p>问题是：内容太多，选择障碍？学习不能？</p>
                    </section>
                    <section>
                        <h2>前端规模扩大</h2>
                        <p>问题是：埋头就是干，工作效率低？各自为政，沟通不畅？</p>
                    </section>

                    <section>
                        <h2>前端责任变重</h2>
                        <p>问题是：页面仔，呵呵！</p>
                    </section>
                </section>

                <section>
                    <section>
                        <h1>工程团队问题赏析</h1>
                    </section>
                    <section>
                        <h2>风格之争</h2>
                        <pre><code class="hljs javascript" data-trim>
function get( obj, key, defaultVal )
{
  if(!obj)
  {
    return defaultVal
  }
  return obj[key] || defaultVal
}
                        </code></pre>
                        <p class="center">VS</p>
                        <pre><code class="hljs javascript" data-trim>
const get = function(obj, key, defaultVal) {
    if (!obj) {
        return defaultVal;
    }
    return obj[key] || defaultVal;
};
                        </code></pre>
                    </section>

                    <section>
                        <h2>约定之争</h2>
                        <pre><code class="hljs javascript" data-trim>
const get = function(obj, key, defaultVal) {
    let res;
    if (obj) {
        if (obj[key]) {
            res = obj[key];
        } else {
            res = defaultVal;
        }
    } else {
        res = defaultVal;
    }
    return res;
};
                        </code></pre>
                        <p class="center">VS</p>
                        <pre><code class="hljs javascript" data-trim>
const get = function(obj, key, defaultVal) {
    if (!obj) {
        return defaultVal;
    }
    return obj[key] || defaultVal;
};
                        </code></pre>
                    </section>

                    <section>
                        <h2>Tab Space 之争</h2>
                        <p>详见：<a href="http://johnhax.net/2016/tab-vs-space">tab-vs-space by Hax</a></p>
                        <p>详见：<a href="http://ooxx.me/tabs-vs-spaces.orz">tab-vs-space by MaDao</a></p>
                    </section>

                    <section>
                        <h2>操作系统之争</h2>
                        <p><code>OS X</code> ? </p>
                        <p><code>Windows</code> ?</p>
                        <p><code>Linux</code> ?</p>
                    </section>

                    <section>
                        <h1>然并卵</h1>
                        <h3 class="fragment fade-in">说破大天，也仅仅是不同人的喜好问题</h3>
                        <h3 class="fragment fade-in">但是。。。。</h3>
                    </section>

                    <section>
                        <h2>土匪 VS 三角洲</h2>
                        <h2 class="fragment fade-in">豆腐渣工程 VS 米兰大教堂</h2>
                        <h2 class="fragment fade-in">独乐乐 VS 众乐乐</h2>
                        <h2 class="fragment fade-in">花心大少 VS 负责到底</h2>
                    </section>

                    <section>
                        <h1>规矩是可靠团队的前提</h1>
                    </section>

                    <section>
                        <h2>统一代码风格</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>领域</th>
                                    <th>工具</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>JavaScript</td>
                                    <td><a href="http://eslint.org">ESLint</a>, <a href="https://github.com/millermedeiros/esformatter">esformatter</a></td>
                                </tr>
                            </tbody>
                        </table>
                    </section>

                    <section>
                        <h2>感受Linting</h2>
                        <img src="img/linting.gif" alt="">
                    </section>

                    <section>
                        <h2>感受Formatting</h2>
                        <img src="img/formatting.gif" alt="">
                    </section>

                    <section>
                        <h2>不在无意义的事上花时间</h2>
                        <h2 class="fragment fade-in">打造高效率、高质量机动部队</h2>
                    </section>

                    <section>
                        <h2>你应该是这样的</h2>
                        <img src="img/tears-of-sun.jpg" alt="">
                    </section>
                </section>

                <section>
                    <section>
                        <h1>工程化问题赏析</h1>
                    </section>

                    <section>
                        <h3>太多请求</h3>
                        <h3 class="fragment fade-in">不使用CDN</h3>
                        <h3 class="fragment fade-in">未合理利用缓存</h3>
                        <h3 class="fragment fade-in">无压缩</h3>
                        <h3 class="fragment fade-in">太多跳转</h3>
                        <h3 class="fragment fade-in">太多DOM操作</h3>
                        <h3 class="fragment fade-in">使用过度资源，例如：大图片缩小显示</h3>
                    </section>

                    <section>
                        <h2>减少请求</h2>
                        <ul>
                            <li>雪碧图、小图片转<code>base64</code></li>
                            <li>CSS concatenation</li>
                            <li>JS concatenation, bundling</li>
                        </ul>
                    </section>

                    <section>
                        <h2>利用CDN</h2>
                        <img src="img/cdn-ntt-com.jpg" alt="">
                    </section>

                    <section>
                        <h2>压缩静态资源</h2>
                        <ul>
                            <li>JavaScript minify</li>
                            <li>CSS minify</li>
                            <li>HTML minity</li>
                            <li>网络请求<code>gzip</code>，详见<a href="http://nginx.org/en/docs/http/ngx_http_gzip_module.html#directives">nginx-gzip</a></li>
                        </ul>
                    </section>

                    <section>
                        <h2>不做无谓跳转</h2>
                        <p>譬如：<code>www.taobao.com/</code> => <code>wwww.taobao.com</code></p>
                        <small>有SEO顾虑时，额外处理</small>
                    </section>

                    <section>
                        <h2>减少DOM操作</h2>
                        <ul>
                            <li>慎重思考大批量的DOM操作，详见：<a href="#/6/6">疯狂操作DOM</a></li>
                            <li>引入<code>virtual DOM</code>工具</li>
                        </ul>
                    </section>

                    <section>
                        <h2>使用合适的资源</h2>
                        <ul>
                            <li>显示区域<code>70px * 70px</code>，就别用什么高清图</li>
                            <li>只用个模版引擎，就别引入<code>angular.js</code></li>
                            <li>只用栅栏布局，就别把<code>Bootstrap</code>一整套都引入</li>
                            <li>只用个“退出”图标，就别把一整套<code>font-awesome</code>引入</li>
                        </ul>
                    </section>
                    
                </section>

                <section>
                    <section>
                        <h1>程序问题赏析</h1>
                    </section>
                    <section>
                        <h2>不使用严格模式</h2>
                        <pre><code class="hljs javascript" data-trim>
(function() {
    userName = 'HanMeimei';
}());
console.log('userName', userName);//全局变量，居然能运行？
                        </code></pre>
                        <p class="center">改成</p>
                        <pre class="fragment fade-in"><code class="hljs javascript" data-trim>
'use strict';
(function() {
    userName = 'HanMeimei';
}());
console.log('userName', userName);//ReferenceError
                        </code></pre>
                    </section>

                    <section>
                        <h2>不用<code>===</code></h2>
                        <pre><code class="hljs javascript" data-trim>
1 == '1'; // true
false == '  '; // true
true == [1]; // true
                        </code></pre>
                        <img src="img/wtf.jpg" alt="">
                    </section>

                    <section>
                        <h2>不清晰的表达式</h2>
                        <pre><code class="hljs javascript" data-trim>
if ((value.length === 4 || value.length === 5) && (Math.round(value) === parseInt(value))) {
    //...
}
                        </code></pre>
                        <p class="center">改成</p>
                        <pre class="fragment fade-in"><code class="hljs javascript" data-trim>
const isZipCode = (value.length === 4 || value.length === 5) && (Math.round(value) === parseInt(value)); 
if (isZipCode) {
    //...
}
                        </code></pre>
                    </section>

                    <section>
                        <h2>执着使用<code>for</code></h2>
                        <pre><code class="hljs javascript" data-trim>
var result = [];
for (var i = 0; i < homeIds.length; i++) {
    for (var j = 0; j < data.length; j++) {
        if (homeIds[i] == data[j].propertyId) {
            result.push(data[j]);
        }
    }
}
                        </code></pre>
                        <p class="center">改成</p>
                        <pre class="fragment fade-in"><code class="hljs javascript" data-trim>
const result = data.filter(d => homeIds.includes(d.propertyId));
                        </code></pre>
                    </section>

                    <section>
                        <h2>疯狂拼接字符串</h2>
                        <pre><code class="hljs javascript" data-trim>
var widgetStructure = '<div id=' + widgetID + '>' +
    '<h2 id="' + widgetTitleID + '">' + widgetTitle + '</h2>' +
    '<div id="' + widgetContentID + '" style="' + widgetContentStyles + '">' +
        (function() {
            var paras = '';
            for (var i = 0; i < paraItems.length; ++i) {
                paras += '<p>' + paraItems[i] + '</p>';
            }
            return paras;
        })() +
    '</div>' +
'</div>';
                        </code></pre>
                        <p>试试模版工具吧</p>
                    </section>

                    <section>
                        <h2>疯狂操作DOM</h2>
                        <pre><code class="hljs javascript" data-trim>
for (var i = 0; i < 100; ++i) {
    ele.appendChild(document.createElement('div'));
}
                        </code></pre>
                        <p class="center">要么改用<code>fragment</code></p>
                        <pre><code class="hljs javascript" data-trim>
const fragment = document.createDocumentFragment();
for (let i = 0; i < 100; ++i) {
    fragment.appendChild(document.createElement('div'));
}
ele.appendChild(fragment);
                        </code></pre>
                        <p class="center">要么改用试试<code>virtual DOM</code>工具</p>
                    </section>

                    <section>
                        <h2>缺乏抽象</h2>
                        <pre><code class="hljs javascript" data-trim>
const putElephantInFridge = function () {
    raiseArm();
    holdFridgeDoor();
    holdItTightly();
    pullFridgeDoor();
    while (doorAnglar > 90) { pullFridgeDoorBack(20); }
    pushElephant();
    while (cannotCloseDoor) {
        riseFoot();
        kickElephant();
        tryCloseDoor();
    }
};
                        </code></pre>
                        <p class="center">改成</p>
                        <pre class="fragment fade-in"><code class="hljs javascript" data-trim>
const putElephantInFridge = function () {
    openFridgeDoor();
    putElephant();
    closeDoor();
};
                        </code></pre>
                    </section>
                    <section>
                        <h2>滥用正则表达式</h2>
                        <pre><code class="hljs javascript" data-trim>
const reg = /a*(.*)*d.*/;
reg.test('24rih');// ~1ms
reg.test('24rih9jihsf6j');// ~20ms
reg.test('24rih9jihsf90uknjk8yzxc');// ~329ms
                        </code></pre>
                        <p class="fragment fade-in">提防<a href="https://en.wikipedia.org/wiki/ReDoS">regular expression denial of service</a></p>
                    </section>

                    <section>
                        <h2>滥用闭包</h2>
                        <pre><code class="hljs javascript" data-trim>
for (let i = 0; i < 1000000; i++) {
    const setupAlertTimeout = function() {
        let msg = 'Message to alert';
        setTimeout(function() {
            let test = 'aaa' + msg;
        }, 100);
    };
    setupAlertTimeout();
}//totally ~951ms
                        </code></pre>
                        <p class="center">改成</p>
                        <pre><code class="hljs javascript" data-trim>
const alertMsg = function() {
    let msg = 'Message to alert';
    let test = 'aaa' + msg;
};

for (let i = 0; i < 1000000; i++) {
    const setupAlertTimeout = function() {
        setTimeout(alertMsg, 100);
    };
    setupAlertTimeout();
}//totally ~441ms
                        </code></pre>
                    </section>

                    <section>
                        <h1>优化(重构)之路漫漫其修远兮</h1>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>选择合适的工具</h2>
                        <h4>提高开发效率</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>领域</th>
                                    <th>工具</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>JavaScript</td>
                                    <td><a href="http://gruntjs.com/">Grunt</a>, <a href="http://gulpjs.com/">gulp</a>, <a href="http://brunch.io/">brunch</a> | <a href="http://browserify.org/">browserify</a>, <a href="https://webpack.github.io/">webpack</a>, <a href="http://rollupjs.org/">rollup</a></td>
                                </tr>
                                <tr>
                                    <td>CSS</td>
                                    <td><a href="http://postcss.org/">PostCSS</a> | <a href="http://lesscss.org/">Less</a>, <a href="http://sass-lang.com/">Sass</a> | <a href="http://stylus-lang.com/">Stylus</a></td>
                                </tr>
                                <tr>
                                    <td>HTML</td>
                                    <td><a href="http://shopify.github.io/liquid/">Liquid</a>, <a href="http://ejs.co/">EJS</a>, <a href="https://pugjs.org">pug</a></td>
                                </tr>
                            </tbody>
                        </table>
                    </section>

                    <section>
                        <h2>利用常见的工具</h2>
                        <h4>发现问题所在</h4>
                        <img src="img/timeline.png" alt="">
                    </section>

                    <section>
                        <h2>定位罪魁祸首</h2>
                        <img src="img/locate-caller.png" alt="">
                    </section>

                    <section>
                        <h2>跟上时代</h2>
                        <p>今天你的网站<code>http2</code>了么？</p>
                        <img src="img/http2.gif" alt="">
                    </section>
                </section>

                <section>
                    <h2>总结</h2>
                    <p>优化不止是牛逼、吊诡的算法，还有软件工程里的规矩</p>
                    <p>好的软件应该时刻保持警惕，注意代码中的“bad smell”</p>
                    <p>高效团队应该打造 || 善用工具，而非“埋头就是干”</p>
                </section>

                <section style="text-align: left;">
                    <h1>额外阅读</h1>
                    <p>
                        - <a href="https://kangax.github.io/compat-table/es6/">ECMAScript 6 compatibility table</a> <br>
                        - <a href="https://segmentfault.com/a/1190000006636138">我眼中软件工程里的常识</a> <br>
                        - <a href="http://www.php100.com/html/itnews/it/2012/0229/9946.html">优秀程序设计的18大原则</a> <br>
                    </p>
                </section>

            </div>

        </div>

        <script src="lib/js/head.min.js"></script>
        <script src="js/reveal.js"></script>

        <script>
            // More info https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: true,
                progress: true,
                history: true,
                center: true,
                transition: 'slide', // none/fade/slide/convex/concave/zoom
                width: 1090,
                // More info https://github.com/hakimel/reveal.js#dependencies
                dependencies: [
                    { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                    { src: 'plugin/zoom-js/zoom.js', async: true },
                    { src: 'plugin/notes/notes.js', async: true }
                ]
            });
        </script>

    </body>
</html>